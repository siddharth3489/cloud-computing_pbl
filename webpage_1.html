<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Lecture Browser — Video + Notes</title>
<style>
  :root{--accent:#0b76ef;--bg:#f4f7fb;--card:#fff;--muted:#666}
  body{font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial; margin:0; background:var(--bg); color:#222}
  .wrap{max-width:1100px;margin:28px auto;padding:18px}
  header{display:flex;gap:16px;align-items:center}
  header h1{margin:0;font-size:20px}
  .grid{display:grid;grid-template-columns:360px 1fr;gap:18px;margin-top:18px}
  .card{background:var(--card);padding:14px;border-radius:10px;box-shadow:0 6px 18px rgba(10,10,20,0.06)}
  label{display:block;font-size:13px;margin-bottom:6px;color:var(--muted)}
  select,button,input[type="text"]{width:100%;padding:8px 10px;border-radius:8px;border:1px solid #e3e9f0;background:white}
  .lecture-list{margin-top:10px;max-height:420px;overflow:auto}
  .lecture-item{display:flex;justify-content:space-between;align-items:center;padding:10px;border-radius:8px;border:1px solid #f0f3f8;margin-bottom:8px;cursor:pointer}
  .lecture-item:hover{background:#f7fbff}
  .video-area{display:flex;flex-direction:column;gap:12px}
  video{width:100%;border-radius:10px;background:black}
  .controls{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
  .btn{padding:8px 12px;border-radius:8px;border:0;background:var(--accent);color:white;cursor:pointer}
  .btn.secondary{background:#efefef;color:#333}
  .scrubber{position:relative;height:10px;background:#e6eefc;border-radius:10px;cursor:pointer;overflow:hidden}
  .progress{position:absolute;left:0;top:0;height:100%;background:var(--accent);width:0}
  .markers{position:absolute;left:0;top:0;height:100%;width:100%;pointer-events:none}
  .marker{position:absolute;top:0;width:6px;height:100%;transform:translateX(-50%);background:rgba(255,64,64,0.95);border-radius:3px}
  .notes{margin-top:8px;max-height:180px;overflow:auto}
  .note{padding:8px;border-radius:8px;border:1px dashed #e8eef9;margin-bottom:8px;display:flex;justify-content:space-between;gap:10px;align-items:center}
  .note small{color:var(--muted)}
  .meta{font-size:13px;color:var(--muted)}
  .row{display:flex;gap:8px;align-items:center}
  .speed-select{width:110px}
  .muted{color:var(--muted);font-size:13px}
  .pill{background:#f1f7ff;padding:6px 10px;border-radius:999px;font-size:13px;color:var(--accent);border:1px solid #e6f0ff}
  /* modal */
  .modal-back{position:fixed;inset:0;background:rgba(10,12,20,0.45);display:none;align-items:center;justify-content:center}
  .modal{background:white;padding:14px;border-radius:10px;min-width:320px;max-width:90%}
  .modal textarea{width:100%;min-height:90px;padding:8px;border-radius:8px;border:1px solid #e9f0fb}
  .tiny{font-size:12px;color:var(--muted)}
  @media (max-width:880px){.grid{grid-template-columns:1fr}}
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>Lecture Browser — Video + Notes</h1>
      <!-- <div class="pill">Demo UI for mentor</div> -->
    </header>

    <div class="grid">
      <!-- LEFT: selection + lecture list -->
      <aside class="card">
        <div>
          <label>Subject</label>
          <select id="subjectSelect"></select>
        </div>
        <div style="margin-top:10px">
          <label>Topic</label>
          <select id="topicSelect"></select>
        </div>
        <div style="margin-top:10px">
          <label>Subtopic</label>
          <select id="subtopicSelect"></select>
        </div>

        <div style="margin-top:14px">
          <label>Lectures</label>
          <div class="lecture-list" id="lectureList">
            <!-- populated dynamically -->
          </div>
        </div>
      </aside>

      <!-- RIGHT: video + controls + notes -->
      <main class="card video-area">
        <div>
          <video id="video" preload="metadata" controls playsinline>
            <!-- set source via JS -->
            Sorry, your browser does not support HTML5 video.
          </video>
        </div>

        <div class="controls">
          <button class="btn" id="playPauseBtn">Play ▶</button>
          <div class="row">
            <label class="tiny" style="margin:0 6px 0 0">Speed</label>
            <select id="speed" class="speed-select">
              <option>0.5</option>
              <option>0.75</option>
              <option selected>1</option>
              <option>1.25</option>
              <option>1.5</option>
              <option>2</option>
            </select>
          </div>

          <button class="btn secondary" id="addNoteBtn" style="margin-left:8px">Add Flag / Note</button>

          <div style="margin-left:auto;text-align:right">
            <div class="muted" id="timeDisplay">00:00 / 00:00</div>
            <div class="muted" id="currentLectureTitle">No lecture loaded</div>
          </div>
        </div>

        <div>
          <div class="scrubber" id="scrubber">
            <div class="progress" id="progress"></div>
            <div class="markers" id="markers"></div>
          </div>
        </div>

        <div>
          <h3 style="margin:10px 0 6px">Notes & Flags</h3>
          <div class="notes" id="notesContainer">
            <div class="muted">No notes yet for this lecture.</div>
          </div>
        </div>
      </main>

    </div>
  </div>

  <!-- modal for adding note -->
  <div class="modal-back" id="modalBack">
    <div class="modal">
      <h4 style="margin:0 0 8px">Add flag / note</h4>
      <div class="tiny" id="modalTime">Time: 0:00</div>
      <textarea id="noteText" placeholder="Write a short note or reason for flag (optional)"></textarea>
      <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:8px">
        <button class="btn secondary" id="cancelNote">Cancel</button>
        <button class="btn" id="saveNote">Save</button>
      </div>
    </div>
  </div>

<script>
/*
  Demo data: replace 'src' with your actual file paths or URLs.
  Each lecture needs a unique id (used for localStorage keys).
*/
const data = {
  "Mathematics": {
    "Algebra": {
      "Quadratics": [
        { id: "math-alg-quad-1", title: "Quadratic — Lecture 1", src: "videos/math_alg_quad_1.mp4" },
        { id: "math-alg-quad-2", title: "Quadratic — Lecture 2", src: "videos/math_alg_quad_2.mp4" }
      ],
      "Linear Equations": [
        { id: "math-alg-lin-1", title: "Linear — Lecture 1", src: "videos/math_alg_lin_1.mp4" }
      ]
    },
    "Calculus": {
      "Derivatives": [
        { id: "math-calc-der-1", title: "Derivatives — Lecture 1", src: "videos/math_calc_der_1.mp4" }
      ]
    }
  },
  "Computer Science": {
    "Data Structures": {
      "Linked Lists": [
        { id: "cs-ds-ll-1", title: "Linked Lists — Lecture 1", src: "videos/ll_pbl_cloud.mp4" }
      ],
      "Trees": [
        { id: "cs-ds-tree-1", title: "Trees — Lecture 1", src: "videos/cs_trees_1.mp4" }
      ]
    }
  }
};

/* ---------- helpers ---------- */
const el = id => document.getElementById(id);
function formatTime(seconds){
  if(!isFinite(seconds) || seconds < 0) return "0:00";
  const h = Math.floor(seconds/3600);
  const m = Math.floor(seconds/60) % 60;
  const s = Math.floor(seconds % 60);
  if(h>0) return `${h}:${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
  return `${m}:${String(s).padStart(2,'0')}`;
}

/* ---------- populate selects ---------- */
const subjectSelect = el('subjectSelect');
const topicSelect = el('topicSelect');
const subtopicSelect = el('subtopicSelect');
const lectureList = el('lectureList');

function populateSubjects(){
  subjectSelect.innerHTML = '';
  Object.keys(data).forEach((s,i)=>{
    const opt = document.createElement('option'); opt.value = s; opt.textContent = s;
    subjectSelect.appendChild(opt);
  });
  subjectSelect.selectedIndex = 0;
  populateTopics();
}
function populateTopics(){
  const s = subjectSelect.value;
  topicSelect.innerHTML = '';
  if(!s || !data[s]) return;
  Object.keys(data[s]).forEach(t=>{
    const opt = document.createElement('option'); opt.value = t; opt.textContent = t;
    topicSelect.appendChild(opt);
  });
  topicSelect.selectedIndex = 0;
  populateSubtopics();
}
function populateSubtopics(){
  const s = subjectSelect.value;
  const t = topicSelect.value;
  subtopicSelect.innerHTML = '';
  if(!s || !t || !data[s][t]) return;
  Object.keys(data[s][t]).forEach(st=>{
    const opt = document.createElement('option'); opt.value = st; opt.textContent = st;
    subtopicSelect.appendChild(opt);
  });
  subtopicSelect.selectedIndex = 0;
  populateLectures();
}
function populateLectures(){
  lectureList.innerHTML = '';
  const s = subjectSelect.value;
  const t = topicSelect.value;
  const st = subtopicSelect.value;
  if(!s || !t || !st || !data[s][t][st]) {
    lectureList.innerHTML = '<div class="muted">No lectures</div>';
    return;
  }
  data[s][t][st].forEach(lec=>{
    const item = document.createElement('div'); item.className = 'lecture-item';
    item.innerHTML = `<div>
        <strong>${lec.title}</strong><div class="meta">${s} › ${t} › ${st}</div>
      </div>
      <div style="min-width:120px;display:flex;gap:8px;align-items:center">
        <button class="btn secondary small" data-id="${lec.id}" aria-label="preview">Preview</button>
        <button class="btn" data-id="${lec.id}" data-src="${lec.src}" data-title="${lec.title}">Open</button>
      </div>`;
    lectureList.appendChild(item);
    item.querySelector('.btn').addEventListener('click', e=>{
      loadLecture(lec);
    });
    item.querySelector('.btn.secondary').addEventListener('click', e=>{
      alert('Preview not implemented in demo. Click Open to load the lecture.');
    });
  });
}

/* ---------- video + notes ---------- */
const video = el('video');
const playPauseBtn = el('playPauseBtn');
const speed = el('speed');
const addNoteBtn = el('addNoteBtn');
const notesContainer = el('notesContainer');
const timeDisplay = el('timeDisplay');
const currentLectureTitle = el('currentLectureTitle');

const progress = el('progress');
const scrubber = el('scrubber');
const markers = el('markers');

let currentLecture = null; // {id,title,src}
let notes = []; // array for current lecture: {time, text, id}
let rafId = null;

/* localStorage helpers */
function notesKeyFor(lectureId){ return 'notes::'+lectureId; }
function loadNotesFor(lectureId){
  const raw = localStorage.getItem(notesKeyFor(lectureId));
  if(!raw) return [];
  try { return JSON.parse(raw); } catch(e){ return []; }
}
function saveNotesFor(lectureId,arr){
  localStorage.setItem(notesKeyFor(lectureId), JSON.stringify(arr));
}

/* load lecture */
function loadLecture(lec){
  currentLecture = lec;
  video.pause();
  // set source
  // NOTE: for cross-origin remote files you may need proper CORS headers
  video.src = lec.src;
  video.load();
  currentLectureTitle.textContent = lec.title;
  // load notes
  notes = loadNotesFor(lec.id) || [];
  renderNotes();
  clearMarkers();
  // update scrubber when metadata available
}

/* play/pause toggle */
playPauseBtn.addEventListener('click', ()=>{
  if(video.paused) { video.play(); } else { video.pause(); }
});
video.addEventListener('play', ()=> playPauseBtn.textContent = 'Pause ❚❚');
video.addEventListener('pause', ()=> playPauseBtn.textContent = 'Play ▶');

/* speed */
speed.addEventListener('change', ()=>{
  const v = parseFloat(speed.value) || 1;
  video.playbackRate = v;
});

/* time updates and progress scrubber */
video.addEventListener('timeupdate', ()=>{
  const cur = video.currentTime;
  const dur = video.duration || 0;
  const pct = dur ? (cur/dur*100) : 0;
  progress.style.width = pct + '%';
  timeDisplay.textContent = `${formatTime(cur)} / ${formatTime(dur)}`;
});
video.addEventListener('loadedmetadata', ()=>{
  // redraw markers using duration and notes
  renderMarkers();
  // update display immediately
  timeDisplay.textContent = `${formatTime(video.currentTime)} / ${formatTime(video.duration)}`;
});
video.addEventListener('ended', ()=> playPauseBtn.textContent = 'Play ▶');

/* scrubber click to seek */
scrubber.addEventListener('click', (e)=>{
  if(!video.duration) return;
  const r = scrubber.getBoundingClientRect();
  const pos = (e.clientX - r.left) / r.width;
  video.currentTime = pos * video.duration;
});

/* add note modal handling */
const modalBack = el('modalBack');
const modalTime = el('modalTime');
const noteText = el('noteText');
const cancelNote = el('cancelNote');
const saveNote = el('saveNote');

addNoteBtn.addEventListener('click', ()=>{
  if(!currentLecture) { alert('Open a lecture first'); return; }
  // show modal, set time
  const t = video.currentTime || 0;
  modalTime.textContent = 'Time: ' + formatTime(t);
  noteText.value = '';
  modalBack.style.display = 'flex';
  noteText.focus();
  // store temp time in dataset
  modalBack.dataset.time = String(t);
});

cancelNote.addEventListener('click', ()=> modalBack.style.display = 'none');
saveNote.addEventListener('click', ()=>{
  const t = parseFloat(modalBack.dataset.time || '0');
  const txt = noteText.value.trim();
  const entry = { id: String(Date.now()) + Math.random().toString(36).slice(2,6), time: t, text: txt };
  notes.push(entry);
  notes.sort((a,b)=>a.time - b.time);
  saveNotesFor(currentLecture.id, notes);
  renderNotes();
  renderMarkers();
  modalBack.style.display = 'none';
});

/* render notes list */
function renderNotes(){
  notesContainer.innerHTML = '';
  if(!notes || notes.length === 0){
    notesContainer.innerHTML = '<div class="muted">No notes yet for this lecture.</div>';
    return;
  }
  notes.forEach(n=>{
    const div = document.createElement('div'); div.className = 'note';
    div.innerHTML = `<div>
        <strong>${formatTime(n.time)}</strong>
        <div class="tiny">${n.text ? n.text : '<span class="muted">No note text — just flagged</span>'}</div>
      </div>
      <div style="min-width:110px">
        <button class="btn secondary" data-jump="${n.time}">Go to</button>
        <button class="btn" data-del="${n.id}">Delete</button>
      </div>`;
    notesContainer.appendChild(div);

    div.querySelector('[data-jump]').addEventListener('click', ()=>{
      video.currentTime = n.time;
      video.play();
    });
    div.querySelector('[data-del]').addEventListener('click', ()=>{
      if(!confirm('Delete this note?')) return;
      notes = notes.filter(x=> x.id !== n.id);
      saveNotesFor(currentLecture.id, notes);
      renderNotes();
      renderMarkers();
    });
  });
}

/* markers: show small red ticks on scrubber */
function clearMarkers(){ markers.innerHTML = ''; }
function renderMarkers(){
  clearMarkers();
  if(!notes || notes.length === 0 || !video.duration) return;
  notes.forEach(n=>{
    const pct = (n.time / video.duration) * 100;
    if(!isFinite(pct)) return;
    const m = document.createElement('div'); m.className = 'marker';
    m.title = formatTime(n.time) + (n.text ? ' — ' + n.text : '');
    m.style.left = pct + '%';
    markers.appendChild(m);
    // allow clicking markers to seek
    m.addEventListener('click', (e)=>{
      e.stopPropagation();
      video.currentTime = n.time;
      video.play();
    });
  });
}

/* initial population */
subjectSelect.addEventListener('change', populateTopics);
topicSelect.addEventListener('change', populateSubtopics);
subtopicSelect.addEventListener('change', populateLectures);

populateSubjects();

/* if you want to pre-load a lecture automatically, uncomment and set:
loadLecture(data['Mathematics']['Algebra']['Quadratics'][0]);
*/
</script>
</body>
</html>
